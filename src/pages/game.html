<!DOCTYPE html>
<html>
<head>
	<title>Poker Game</title>
	<link rel="stylesheet" type="text/css" href="style.css">	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/2.4.6/fabric.min.js"></script>
	<script src="socket.io.js"></script>
	<script type ="text/javascript" src="display.js"></script>

	<script type="text/javascript">
	
		//Moved chat.html functionality to game page
		const socket = io()
		// on connection to server, ask for user's name with an anonymous callback
		socket.on('connect', function(){
			// call the server-side function 'adduser' and send one parameter (value of prompt)
			let name = "guest";
			$(function () {
				$.get('http://localhost/update_username', function(chatMessage, textStatus) {
					console.log(chatMessage);
					name = chatMessage;
					console.log(name);
					socket.emit('adduser', name);
				});
			})

		}); 

		// listener, whenever the server emits 'updatechat', this updates the chat body
		socket.on	('updatechat', function (username, chatMessage) {
			console.log(chatMessage);
			$('#chatDisplay').append('<b>'+username + ':</b> ' + chatMessage + '<br>');
		});

		socket.on  ('updatedisplay', function(value, name){
			console.log(name + ": " + value);
		});

		// listener, whenever the server emits 'updaterooms', this updates the room the client is in

		// on load of page
		$(function(){

			drawRoom("pokerDisplay",$("#pokerDisplay").height(), $("#pokerDisplay").width());
			
			// when the client clicks SEND
			$('#chatSubmit').click( function() {
				var message = $('#chatMessage').val();
				$('#chatMessage').val('');
				// tell server to execute 'sendchat' and send along one parameter
				socket.emit('sendchat', message);
			});

			// when the client hits ENTER on their keyboard
			$('#chatMessage').keypress(function(e) {
				if(e.which == 13) {
					$(this).blur();
					$('#chatSubmit').focus().click();
				}
			});
		});
	</script>
</head>

<body>
	<canvas id="pokerDisplay">
		
	</canvas>
	<div id="gameBar">
		<div class="sub-container" id="chatBox">
			<div class="tab-select">
				<div class="tab-head" id="chat">
					chat
				</div>
				<div class="tab-head" id="history">
					History
				</div>
				<div class="tab-head" id="hintLog">
					Hint Log
				</div>
			</div>
			<div id="chatDisplay">
				
			</div>
			<div id="chatInputField">
				<input id="chatMessage">
				<input type="button" id="chatSubmit" value="submit">
			</div>
		</div>
		<div class="sub-container" id="hintBox">
			<input type="button" name="hint" value="HINT">
		</div>
		<div class="sub-container" id="playerActions">
			<div class="tab-select">
				<div class="tab-head" id="halfPotTab">
					1/2 Pot
				</div>
				<div class="tab-head" id="fullPotTab">
					Pot
				</div>
				<div class="tab-head" id="allInTab">
					All In
				</div>
				<div class="tab-head" id="customTab">
					Custom Amount
				</div>
			</div>
			<div id="playerActionButtons">
				<input type="button" name="Fold" value="Fold">
				<input type="button" name="Call" value="Call">
				<input type="button" name="Raise" value="Raise">	
			</div>
		</div>
	</div>
</body>
</html>