<!DOCTYPE html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>

<script>
let name;

window.onload = function() {
  $.ajax({
    async: false,
    type: 'GET',
    //url: 'http://pokeruniversity.herokuapp.com/getRooms',
    url: '/update_username',
    success: function(data) {
        name=data;
    }
  })
}

  $(function() {
    $('#leader_chips').click( function() {
      $.ajax({
        async: false,
        type: 'GET',
        url: '/get_leaderboard_chips',
        success: function(data) {
          document.getElementById('board').innerHTML = "";
          for (let i = 0; i < data.length; i++) {
            document.getElementById('board').innerHTML += (data[i] + "</br>")
          }
        }
      })
    })
  })
  $(function() {
    $('#leader_wins').click( function() {
      $.ajax({
        async: false,
        type: 'GET',
        url: '/get_leaderboard_wins',
        success: function(data) {
          document.getElementById('board').innerHTML = "";
          for (let i = 0; i < data.length; i++) {
            document.getElementById('board').innerHTML += (data[i] + "</br>")
          }
        }
      })
    })
  })
  $(function() {
    $('#leader_percent').click( function() {
      $.ajax({
        async: false,
        type: 'GET',
        url: '/get_leaderboard_percentage',
        success: function(data) {
          document.getElementById('board').innerHTML = "";
          for (let i = 0; i < data.length; i++) {
            document.getElementById('board').innerHTML += (data[i] + "</br>")
          }
        }
      })
    })
  })
  $(function() {
    $('#delete').click( function() {
      let nameCheck = prompt("Are you sure you want to delete your profile? This cannot be reversed. Type your username if you wish to continue.");
      if (nameCheck == name) {
        $.ajax({
          async: false,
          type: 'GET',
          url: '/delete_user',
          success: function(data) {
            window.location.replace('/');
          }
        })
      }
    })
  })

  $(function() {
    $('addFriend').click( function() {
      $.ajax({
        async: false,
        type: 'POST',
        
      })
    })
  })

  $(function() {
    $('#friends').click( function() {
      $.ajax({
        async: false,
        type: 'GET',
        url: '/get_requests_and_friends',
        success: function(data) {
          console.log(data);
          let friends = data.friendsArray;
          let requests = data.requestsArray;
          document.getElementById('board').innerHTML = "";
          document.getElementById('board').innerHTML += "FRIENDS</br>";
          for (let i = 0; i < friends.length; i++) {
            document.getElementById('board').innerHTML += (friends[i].username + "</br></br>")
          }
          document.getElementById('board').innerHTML += "REQUESTS</br>";
          for (let i = 0; i < requests.length; i++) {
            document.getElementById('board').innerHTML += (requests[i].username + ' <input type="button" id="addFriend" name="addFriend" value="Accept"></br></br>')
          }
        }
      })
    })
  })
</script>




<html>
<head>
	<title>Profile</title>
</head>
<body>
  <h1> {USER}'s Profile</h1>
  <div class="user_avatar">
    <img src="/avatar/{ID}" width="128" height="128" />
  </div>
  <div id="search1">
    <object align= right>
      <form method="POST" action='search_profiles'>
        <input type="text" id="search" name="search" placeholder="Username">
        <input type="submit" value="Search Profiles">
      </form>
    </object>
  </div>
  <div class="user_profile">
    <p class="field-title">Total Chips: {CHIPS}</br></p>
    <p class="field-title">Total Wins: {WINS}</br></p>
    <a id="passwordRecoveryLink" href="/recover.html">Change Password</br></a>
    <a id="changeUsernameLink" href="/username.html">Change Username</br></a>
    <p id='board'>
    </p>
    <input type="button" id="leader_chips" name="leader" value="Leaderboard Chips">
    <input type="button" id="leader_wins" name="leader" value="Leaderboard Wins">
    <input type="button" id="leader_percent" name="leader" value="Leaderboard Percentage">
    <input type="button" id="delete" name="delete" value="Delete Profile">
    <input type="button" id="friends" name="friends" value="View Friends">
  </div>

</body>
</html>
